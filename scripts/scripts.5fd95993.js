"use strict";if(angular.module("photomapApp",["ngRoute","ngTouch","ngStorage","uiGmapgoogle-maps","cgBusy","afOAuth2"]).config(function(a,b){b.configure({v:"3.17",libraries:"weather,geometry,visualization"}),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/:access_token?",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/album/:provider",{templateUrl:"views/album.html",controller:"AlbumCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/map/:provider/:albumid",{templateUrl:"views/map.html",controller:"MapCtrl"}).otherwise({redirectTo:"/"})}).factory("localFiles",function(){return{}}),angular.module("photomapApp").controller("AlbumCtrl",function(a,b,c,d,e,f){a.isLogin=null!=b.set(),a.provider=f.provider,a.isLogin&&(c.photos=null,a.myPromise=d.get(f.provider).getAlbum(b.get().access_token).then(function(b){a.albums=b,c.albums={title:f.provider,count:a.albums.length}}))}),angular.module("photomapApp").controller("AboutCtrl",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("photomapApp").controller("MapCtrl",function(a,b,c,d,e,f,g,h){a.photos=[],a.map={fit:!0,center:{latitude:59,longitude:18},zoom:8,options:{panControl:!1,rotateControl:!1,scaleControl:!1,streetViewControl:!1,zoomControl:!1},events:{tilesloaded:function(b){a.$apply(function(){a.maps=b})},drag:function(b){a.updateLine()},zoom_changed:function(b){a.updateLine()},center_changed:function(b){a.updateLine()}}};var i=function(a){for(var b=atob(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=new ArrayBuffer(b.length),e=new Uint8Array(d),f=0;f<b.length;f++)e[f]=b.charCodeAt(f);return new Blob([d],{type:c})};a.readPhoto=function(b){var c=new FileReader;c.onloadend=function(b){return function(c){var d=new JpegMeta.JpegFile(atob(c.target.result.replace(/^.*?,/,"")),b),f=new Image;if(f.src=c.target.result,"0000:00:00"!=d.gps.GPSDateStamp.value){var g=i(c.target.result),h=window.URL.createObjectURL(g);a.photos.push({id:d.filename.name,latitude:parseFloat(d.gps.latitude.value),longitude:parseFloat(d.gps.longitude.value),icon:"images/maps/dot_red.png",content:{title:d.filename.name,time:d.filename.lastModified,image:h,thumbnail:h}}),e.photos.count=a.photos.length,a.$apply()}}}(b),c.readAsDataURL(b)},d.then(function(c){f.albumid.split("-");if("local"==f.provider){e.photos={title:"Local",count:0},a.photos=[];for(var d=0;d<h.files.length;d++)!function(b){a.readPhoto(b)}(h.files[d])}else a.myPromise=g.get(f.provider).getPhotos(b.set().access_token,f.albumid).then(function(b){e.photos={title:b.title,count:b.photos.length},a.photos=b.photos})}),a.windowOptions={show:!1},a.onClick=function(b){var c=b.model?b.model:b;a.windowOptions.show=!0,a.windowOptions.coords={latitude:c.latitude,longitude:c.longitude},a.windowOptions.content=c.content,a.map.zoom=16,a.map.center=a.windowOptions.coords},a.closeClick=function(){a.windowOptions.show=!1},a.hoverState=function(b,c,d){a.map.target=d?$(b.target):null,a.map.fit=!1,a.map.center;for(var e in a.photos)if(a.photos[e].id==c.id){a.map.current=d?a.photos[e]:null,a.photos[e].icon=d?"images/maps/dot_green.png":"images/maps/dot_red.png",a.updateLine();break}},a.updateLine=function(){if(null==a.map.current||null==a.map.target)return void $(".line").remove();var b=Math.pow(2,a.maps.getZoom()),c=new google.maps.LatLng(a.maps.getBounds().getNorthEast().lat(),a.maps.getBounds().getSouthWest().lng()),d=a.maps.getProjection().fromLatLngToPoint(c),e=a.maps.getProjection().fromLatLngToPoint(new google.maps.LatLng(a.map.current.latitude,a.map.current.longitude)),f=new google.maps.Point(Math.floor((e.x-d.x)*b),Math.floor((e.y-d.y)*b));a.createLine(f.x,f.y-7,a.map.target.offset().left+a.map.target.outerWidth(!0)/2,a.map.target.offset().top+a.map.target.outerHeight(!0)/2)},a.createLine=function(a,b,c,d){var e=Math.sqrt((a-c)*(a-c)+(b-d)*(b-d)),f=180*Math.atan2(d-b,c-a)/Math.PI,g="rotate("+f+"deg)";$(".line").remove();var h=$("<div>").appendTo("body").addClass("line").css({position:"absolute",transform:g}).width(e).offset({left:a,top:b});return h}}),angular.module("photomapApp").factory("ApiWrapper",function(a,b){var c={};return c.google={getAlbum:function(c){return a(function(a,d){b.jsonp("https://picasaweb.google.com/data/feed/api/user/default",{params:{callback:"JSON_CALLBACK",alt:"json-in-script",access_token:c}}).success(function(b){var c=[];for(var d in b.feed.entry){var e=b.feed.entry[d];c.push({title:e.title.$t,url:e.gphoto$user.$t+"-"+e.gphoto$id.$t,count:e.gphoto$numphotos.$t,author:e.author[0].name.$t,date:e.gphoto$timestamp.$t,image:e.media$group.media$content[0].url})}a(c)})})},getPhotos:function(c,d){return a(function(a,e){var f=d.split("-");b.jsonp("https://picasaweb.google.com/data/feed/api/user/"+f[0]+"/albumid/"+f[1],{params:{callback:"JSON_CALLBACK",alt:"json-in-script",access_token:c}}).success(function(b){var c={title:b.feed.title.$t,photos:[]};for(var d in b.feed.entry){var e=b.feed.entry[d];if(e.georss$where){var f=e.georss$where.gml$Point.gml$pos.$t.split(" ");try{c.photos.push({id:e.gphoto$id.$t,latitude:parseFloat(f[0]),longitude:parseFloat(f[1]),icon:"images/maps/dot_red.png",content:{title:e.title.$t,time:e.exif$tags.exif$time.$t,image:e.content.src,thumbnail:e.media$group.media$thumbnail[0].url}})}catch(g){console.log(e.gphoto$id.$t+" failed with "+g)}}}a(c)})})}},c.facebook={getAlbum:function(c){return a(function(a,d){b.jsonp("https://graph.facebook.com/v2.3/me/albums",{params:{callback:"JSON_CALLBACK",alt:"json-in-script",access_token:c}}).success(function(b){var d=[];for(var e in b.data){var f=b.data[e];d.push({title:f.name,url:f.id,count:f.count,author:f.from.name,date:f.updated_time,image:"https://graph.facebook.com/v2.3/"+f.cover_photo+"/picture?access_token="+c})}a(d)})})},getPhotos:function(c,d){return a(function(a,e){d.split("-");b.jsonp("https://graph.facebook.com/v2.3/"+d+"/photos",{params:{"with":"location",callback:"JSON_CALLBACK",alt:"json-in-script",access_token:c}}).success(function(b){var c={title:"TODO",photos:[]};for(var d in b.data){var e=b.data[d];if(e.place)try{c.photos.push({id:e.id,latitude:parseFloat(e.place.location.latitude),longitude:parseFloat(e.place.location.longitude),icon:"images/maps/dot_red.png",content:{title:e.name,time:e.created_time,image:e.picture,thumbnail:e.picture}})}catch(f){console.log(e.gphoto$id.$t+" failed with "+f)}}a(c)})})}},{list:function(){return{google:{url:"https://accounts.google.com/o/oauth2/auth",client:"707577585652-pp5ln39kak6l51u67eisikv4q3nftbhs.apps.googleusercontent.com",scope:"https://picasaweb.google.com/data/"},facebook:{url:"https://www.facebook.com/dialog/oauth",client:"1003686156322671",scope:"user_photos"}}},get:function(a){return c[a]}}}),angular.module("photomapApp").controller("MainCtrl",function(a,b,c,d,e,f){b.albums=null,b.photos=null,a.services=c.list();var g=e.set();g&&g.state&&d.access_token&&f.url("/album/"+g.state),a.dropped=function(){console.log("files dropped"),f.url("/map/local/dropped"),a.$apply()}}).directive("dropzone",function(a){return{restrict:"A",link:function(b,c){var d=angular.element('<input type="file" style="display: none" multiple />');c.append(d),c.get(0).addEventListener("dragover",function(a){c.addClass("drag-hover"),a.dataTransfer.dropEffect="link",a.preventDefault()}),c.get(0).addEventListener("dragleave",function(a){c.removeClass("drag-hover")}),c.get(0).addEventListener("drop",function(d){d.stopPropagation(),d.preventDefault(),c.removeClass("drag-hover"),a.files=d.dataTransfer.files,b.dropped()}),c.get(0).addEventListener("click",function(a){d.trigger("click")}),d.get(0).addEventListener("change",function(c){a.files=c.target.files,b.dropped()})}}}),angular.module("oauth2.accessToken",["ngStorage"]).factory("AccessToken",["$rootScope","$location","$window","$sessionStorage",function(a,b,c,d){function e(a){if(a){var b=new Date;b.setSeconds(b.getSeconds()+parseInt(a.expires_in)-60),a.expires_at=b}}function f(a){var b=g(a);return null!==b&&(e(b),d.token=b),b}function g(a){for(var b,c={},d=/([^&=]+)=([^&]*)/g;b=d.exec(a);){var e=decodeURIComponent(b[1]),f=decodeURIComponent(b[2]);i.indexOf(e)>=0&&(c[e]=f)}return c.access_token&&c.expires_in||c.error?c:null}var h={token:null},i=["access_token","token_type","expires_in","scope","state","error","error_description"];return h.get=function(){return this.token},h.set=function(){var c=window.location.hash;if(c.length>0&&(0==c.indexOf("#/")&&(c=c.substring(2)),h.token=f(c)),null===h.token&&(h.token=d.token,void 0===h.token&&(h.token=null)),h.token&&h.token.error){var e=h.token.error;h.destroy(),a.$broadcast("oauth2:authError",e)}if(null!==h.token&&(a.$broadcast("oauth2:authSuccess"),d.oauthRedirectRoute)){var g=d.oauthRedirectRoute;d.oauthRedirectRoute=null,b.path(g)}return h.token},h.destroy=function(){d.token=null,delete d.token,h.token=null},h}]),angular.module("oauth2.interceptor",[]).factory("OAuth2Interceptor",["$rootScope","$q","$sessionStorage",function(a,b,c){var d=function(a){return a&&a.expires_at&&new Date(a.expires_at)<new Date},e={request:function(b){var e=c.token;if(d(e))a.$broadcast("oauth2:authExpired",e);else if(e)return b.headers.Authorization="Bearer "+e.access_token,b;return b},response:function(b){var e=c.token;return 401===b.status?d(e)?a.$broadcast("oauth2:authExpired",e):a.$broadcast("oauth2:unauthorized",e):500===b.status&&a.$broadcast("oauth2:internalservererror"),b},responseError:function(b){var e=c.token;return 401===b.status?d(e)?a.$broadcast("oauth2:authExpired",e):a.$broadcast("oauth2:unauthorized",e):500===b.status&&a.$broadcast("oauth2:internalservererror"),b}};return e}]),angular.module("oauth2.endpoint",[]).factory("Endpoint",["AccessToken",function(a){var b={authorize:function(a){b.init(a),window.location.replace(b.url)},appendSignoutToken:!1};return b.signOut=function(a){if(b.signOutUrl&&b.signOutUrl.length>0){var c=b.signOutUrl;b.appendSignoutToken&&(c+=a),window.location.replace(c)}},b.init=function(a){b.url=a.authorizationUrl+"?client_id="+encodeURI(a.clientId)+"&redirect_uri="+encodeURI(a.redirectUrl)+"&response_type="+encodeURI(a.responseType)+"&scope="+encodeURI(a.scope)+"&state="+encodeURI(a.state),b.signOutUrl=a.signOutUrl,"true"==a.signOutAppendToken&&(b.appendSignoutToken=!0),a.signOutRedirectUrl.length>0&&(b.signOutUrl=b.signOutUrl+"?post_logout_redirect_uri="+encodeURI(a.signOutRedirectUrl))},b}]),angular.module("oauth2.directive",[]).directive("oauth2",["$rootScope","$http","$window","$location","$templateCache","$compile","$sessionStorage","AccessToken","Endpoint",function(a,b,c,d,e,f,g,h,i){var j={restrict:"E",replace:!0,scope:{id:"@",authorizationUrl:"@",clientId:"@",redirectUrl:"@",responseType:"@",scope:"@",state:"@",template:"@",buttonClass:"@",signInText:"@",signOutText:"@",signOutUrl:"@",signOutAppendToken:"@",signOutRedirectUrl:"@"}};return j.link=function(b,c,e){function j(){var a='<a class="{{buttonClass}}" style="margin-top:15px" href="#" ng-click="signIn()"><i class="fa fa-{{state}}"></i> {{signInText}}</a>';b.template?(c.html(b.template),f(c.contents())(b)):(c.html(a),f(c.contents())(b))}function k(a,b){b.$$route&&b.$$route.requireToken&&(h.get()||(a.preventDefault(),g.oauthRedirectRoute=d.path(),i.authorize()))}function l(){b.buttonClass=b.buttonClass||"btn btn-primary",b.signInText=b.signInText||"Sign In",b.signOutText=b.signOutText||"Sign Out",b.responseType=b.responseType||"token",b.signOutUrl=b.signOutUrl||"",b.signOutRedirectUrl=b.signOutRedirectUrl||"",b.unauthorizedAccessUrl=b.unauthorizedAccessUrl||"",b.redirectUrl=b.redirectUrl||window.location.origin,j(),b.signedIn=null!==h.set(),b.$on("oauth2:authRequired",function(){i.authorize()}),b.$on("oauth2:authError",function(){b.unauthorizedAccessUrl.length>0&&d.path(b.unauthorizedAccessUrl)}),b.$on("oauth2:authExpired",function(){b.signedIn=!1}),a.$on("$routeChangeStart",k)}b.$watch("clientId",function(a){l()}),b.signedIn=!1,b.signIn=function(){i.authorize(b)},b.signOut=function(){var a=h.get().access_token;h.destroy(),i.signOut(a)}},j}]),angular.module("afOAuth2",["oauth2.directive","oauth2.accessToken","oauth2.endpoint","oauth2.interceptor"]).config(["$locationProvider","$httpProvider",function(a,b){b.interceptors.push("OAuth2Interceptor")}]),this.JpegMeta)throw Error("Library included multiple times");var JpegMeta={};JpegMeta.stringIsClean=function(a){for(var b=0;b<a.length;b++)if(a.charCodeAt(b)<32)return!1;return!0},JpegMeta.parseNum=function(a,b,c,d){var e,f,g=">"===a;for(void 0===c&&(c=0),void 0===d&&(d=b.length-c),e=g?c:c+d-1;g?c+d>e:e>=c;g?e++:e--)f<<=8,f+=b.charCodeAt(e);return f},JpegMeta.parseSnum=function(a,b,c,d){var e,f,g,h=">"===a;for(void 0===c&&(c=0),void 0===d&&(d=b.length-c),e=h?c:c+d-1;h?c+d>e:e>=c;h?e++:e--)void 0===g&&(g=128===(128&b.charCodeAt(e))),f<<=8,f+=g?255&~b.charCodeAt(e):b.charCodeAt(e);return g&&(f+=1,f*=-1),f},JpegMeta.Rational=function(a,b){return this.num=a,this.den=b||1,this},JpegMeta.Rational.prototype.toString=function(){return 0===this.num?""+this.num:1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den},JpegMeta.Rational.prototype.asFloat=function(){return this.num/this.den},JpegMeta.MetaGroup=function(a,b){return this.fieldName=a,this.description=b,this.metaProps={},this},JpegMeta.MetaGroup.prototype._addProperty=function(a,b,c){var d=new JpegMeta.MetaProp(a,b,c);this[d.fieldName]=d,this.metaProps[d.fieldName]=d},JpegMeta.MetaGroup.prototype.toString=function(){return"[MetaGroup "+this.description+"]"},JpegMeta.MetaProp=function(a,b,c){return this.fieldName=a,this.description=b,this.value=c,this},JpegMeta.MetaProp.prototype.toString=function(){return""+this.value},this.JpegMeta.JpegFile=function(a,b){var c=this._SOS;this.metaGroups={},this._binary_data=a,this.filename=b;var d,e,f,g,h,i,j,k=0,l=0;if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".");for(k+=2;k<this._binary_data.length&&(d=this._binary_data.charCodeAt(k++),e=this._binary_data.charCodeAt(k++),l=k,d==this._DELIM)&&e!==c;){for(h=JpegMeta.parseNum(">",this._binary_data,k,2),k+=h;k<this._binary_data.length;)if(d=this._binary_data.charCodeAt(k++),d==this._DELIM&&(f=this._binary_data.charCodeAt(k++),0!=f)){k-=2;break}g=k-l,this._markers[e]?(i=this._markers[e][0],j=this._markers[e][1]):(i="UNKN",j=void 0),j&&this[j](e,l+2,g-2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this},this.JpegMeta.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"},this.JpegMeta.JpegFile.prototype._SOI_MARKER="ÿØ",this.JpegMeta.JpegFile.prototype._DELIM=255,this.JpegMeta.JpegFile.prototype._EOI=217,this.JpegMeta.JpegFile.prototype._SOS=218,this.JpegMeta.JpegFile.prototype._sofHandler=function(a,b){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general","General"),this.general._addProperty("depth","Depth",JpegMeta.parseNum(">",this._binary_data,b,1)),this.general._addProperty("pixelHeight","Pixel Height",JpegMeta.parseNum(">",this._binary_data,b+1,2)),this.general._addProperty("pixelWidth","Pixel Width",JpegMeta.parseNum(">",this._binary_data,b+3,2)),this.general._addProperty("type","Type",this._markers[a][2])},this.JpegMeta.JpegFile.prototype._commentHandler=function(a,b,c){var d,e;for(b++,c--,d=b,e="";b+c>d;)e+=String.fromCharCode(this._binary_data.charCodeAt(d)),d++;this._addMetaGroup("comment","Comment"),this.comment._addProperty("comment","Comment",e)},this.JpegMeta.JpegFile.prototype._JFIF_IDENT="JFIF\x00",this.JpegMeta.JpegFile.prototype._JFXX_IDENT="JFXX\x00",this.JpegMeta.JpegFile.prototype._EXIF_IDENT="Exif\x00",this.JpegMeta.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]},this.JpegMeta.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]},this.JpegMeta.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41989:["Focal length in 35 mm film","FocalLengthIn35mmFilm"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]},this.JpegMeta.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]},this.JpegMeta.JpegFile.prototype._iptctags={0:["Record Version","recordVersion"],3:["Object Type Reference","objectType"],4:["Object Attribute Reference","objectAttribute"],5:["Object Name","objectName"],7:["Edit Status","editStatus"],8:["Editorial Update","editorialUpdate"],10:["Urgency","urgency"],12:["Subject Reference","subjectRef"],15:["Category","category"],20:["Supplemental Category","supplCategory"],22:["Fixture Identifier","fixtureID"],25:["Keywords","keywords"],26:["Content Location Code","contentLocCode"],27:["Content Location Name","contentLocName"],30:["Release Date","releaseDate"],35:["Release Time","releaseTime"],37:["Expiration Date","expirationDate"],38:["Expiration Time","expirationTime"],40:["Special Instructions","specialInstructions"],42:["Action Advised","actionAdvised"],45:["Reference Service","refService"],47:["Reference Date","refDate"],50:["Reference Number","refNumber"],55:["Date Created","dateCreated"],60:["Time Created","timeCreated"],62:["Digital Creation Date","digitalCreationDate"],63:["Digital Creation Time","digitalCreationTime"],65:["Originating Program","originatingProgram"],70:["Program Version","programVersion"],75:["Object Cycle","objectCycle"],80:["By-line","byline"],85:["By-line Title","bylineTitle"],90:["City","city"],92:["Sub-location","sublocation"],95:["Province/State","state"],100:["Country Code","countryCode"],101:["Country Name","countryName"],103:["Original Transmission Reference","origTransRef"],105:["Headline","headline"],110:["Credit","credit"],115:["Source","source"],116:["Copyright Notice","copyrightNotice"],118:["Contact","contact"],120:["Caption/Abstract","caption"],122:["Writer/Editor","writerEditor"],125:["Rasterized Caption","rasterizedCaption"],130:["Image Type","imageType"],131:["Image Orientation","imageOrientation"],135:["Language Identifier","languageID"],150:["Audio Type","audioType"],151:["Audio Sampling Rate","audioSamplingRate"],152:["Audio Sampling Resolution","audioSamplingRes"],153:["Audio Duration","audioDuration"],154:["Audio Outcue","audioOutcue"],200:["Preview File Format","previewFileFormat"],201:["Preview File Format Version","previewFileFormatVer"],202:["Preview Data","previewData"]},this.JpegMeta.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count “0”"],209:["RST1",null,"Restart with modulo 8 count “1”"],210:["RST2",null,"Restart with modulo 8 count “2”"],211:["RST3",null,"Restart with modulo 8 count “3”"],212:["RST4",null,"Restart with modulo 8 count “4”"],213:["RST5",null,"Restart with modulo 8 count “5”"],214:["RST6",null,"Restart with modulo 8 count “6”"],215:["RST7",null,"Restart with modulo 8 count “7”"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["IPTC","_iptcHandler","IPTC Photo Metadata"],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM","_commentHandler","Comment"],1:["JPG13",null]},this.JpegMeta.JpegFile.prototype._addMetaGroup=function(a,b){var c=new JpegMeta.MetaGroup(a,b);return this[c.fieldName]=c,this.metaGroups[c.fieldName]=c,c},this.JpegMeta.JpegFile.prototype._parseIfd=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=JpegMeta.parseNum(a,b,c+d,2);r=this._addMetaGroup(f,g);for(var t=0;s>t;t++)if(h=c+d+2+12*t,i=JpegMeta.parseNum(a,b,h,2),k=JpegMeta.parseNum(a,b,h+2,2),m=JpegMeta.parseNum(a,b,h+4,4),n=JpegMeta.parseNum(a,b,h+8,4),void 0!==this._types[k]){if(j=this._types[k][0],l=this._types[k][1],n=4>=l*m?h+8:c+n,"UNDEFINED"==j)o=void 0;else if("ASCII"==j)o=b.slice(n,n+m),o=o.split("\x00")[0],JpegMeta.stringIsClean(o)||(o="");else{o=new Array;for(var u=0;m>u;u++,n+=l)("BYTE"==j||"SHORT"==j||"LONG"==j)&&o.push(JpegMeta.parseNum(a,b,n,l)),("SBYTE"==j||"SSHORT"==j||"SLONG"==j)&&o.push(JpegMeta.parseSnum(a,b,n,l)),"RATIONAL"==j&&(p=JpegMeta.parseNum(a,b,n,4),q=JpegMeta.parseNum(a,b,n+4,4),o.push(new JpegMeta.Rational(p,q))),"SRATIONAL"==j&&(p=JpegMeta.parseSnum(a,b,n,4),q=JpegMeta.parseSnum(a,b,n+4,4),o.push(new JpegMeta.Rational(p,q))),o.push();1===m&&(o=o[0])}e.hasOwnProperty(i)?r._addProperty(e[i][1],e[i][0],o):console.log("WARNING(jpegmeta.js): Unknown tag: ",i)}},this.JpegMeta.JpegFile.prototype._jfifHandler=function(a,b){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF"),this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(b+5)),this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(b+6)),this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value),this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(b+7)),this.jfif._addProperty("Xdensity","X density",JpegMeta.parseNum(">",this._binary_data,b+8,2)),this.jfif._addProperty("Ydensity","Y Density",JpegMeta.parseNum(">",this._binary_data,b+10,2)),this.jfif._addProperty("Xthumbnail","X Thumbnail",JpegMeta.parseNum(">",this._binary_data,b+12,1)),this.jfif._addProperty("Ythumbnail","Y Thumbnail",JpegMeta.parseNum(">",this._binary_data,b+13,1))},this.JpegMeta.JpegFile.prototype._app0Handler=function(a,b){var c=this._binary_data.slice(b,b+5);c==this._JFIF_IDENT?this._jfifHandler(a,b):c==this._JFXX_IDENT},this.JpegMeta.JpegFile.prototype._app1Handler=function(a,b){var c=this._binary_data.slice(b,b+5);c==this._EXIF_IDENT&&this._exifHandler(a,b+6)},JpegMeta.JpegFile.prototype._exifHandler=function(a,b){if(void 0!==this.exif)throw new Error("Multiple JFIF segments found");var c,d,e,f=this._binary_data.slice(b,b+2);if("II"===f)c="<";else{if("MM"!==f)throw new Error("Malformed TIFF meta-data. Unknown endianess: "+f);c=">"}if(d=JpegMeta.parseNum(c,this._binary_data,b+2,2),42!==d)throw new Error("Malformed TIFF meta-data. Bad magic: "+d);if(e=JpegMeta.parseNum(c,this._binary_data,b+4,4),this._parseIfd(c,this._binary_data,b,e,this._tifftags,"tiff","TIFF"),this.tiff.ExifIfdPointer&&this._parseIfd(c,this._binary_data,b,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif"),this.tiff.GPSInfoIfdPointer){if(this._parseIfd(c,this._binary_data,b,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS"),this.gps.GPSLatitude){var g;g=this.gps.GPSLatitude.value[0].asFloat()+1/60*this.gps.GPSLatitude.value[1].asFloat()+1/3600*this.gps.GPSLatitude.value[2].asFloat(),"S"===this.gps.GPSLatitudeRef.value&&(g=-g),this.gps._addProperty("latitude","Dec. Latitude",g)}if(this.gps.GPSLongitude){var h;h=this.gps.GPSLongitude.value[0].asFloat()+1/60*this.gps.GPSLongitude.value[1].asFloat()+1/3600*this.gps.GPSLongitude.value[2].asFloat(),"W"===this.gps.GPSLongitudeRef.value&&(h=-h),this.gps._addProperty("longitude","Dec. Longitude",h)}}},this.JpegMeta.JpegFile.prototype._iptcHandler=function(a,b,c){this._addMetaGroup("iptc","IPTC");for(var d,e,f,g,h="<",i=JpegMeta.parseNum(h,this._binary_data,b+4,1),j=28,k=2,l=0;c>l;l++)if(e=b+l,JpegMeta.parseNum(h,this._binary_data,e,1)==k){if(g=JpegMeta.parseNum(h,this._binary_data,e+1,1),tag_desc=this._iptctags[g],!tag_desc)continue;for(i=0,d=2;c>d&&JpegMeta.parseNum(h,this._binary_data,e+d,1)!=j&&JpegMeta.parseNum(h,this._binary_data,e+d+1,1)!=k;)d++,i++;if(!i)continue;f=this._binary_data.slice(b+l+2,b+l+2+i),f=f.replace("\x00","").trim(),this.iptc._addProperty(tag_desc[1],tag_desc[0],f),l+=i-1}};